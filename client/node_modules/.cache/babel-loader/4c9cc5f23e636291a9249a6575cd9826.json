{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.select = exports.filter = void 0;\n\nvar css_what_1 = require(\"css-what\");\n\nvar css_select_1 = require(\"css-select\");\n\nvar DomUtils = __importStar(require(\"domutils\"));\n\nvar helpers_1 = require(\"./helpers\");\n\nvar positionals_1 = require(\"./positionals\");\n/** Used to indicate a scope should be filtered. Might be ignored when filtering. */\n\n\nvar SCOPE_PSEUDO = {\n  type: \"pseudo\",\n  name: \"scope\",\n  data: null\n};\n/** Used for actually filtering for scope. */\n\nvar CUSTOM_SCOPE_PSEUDO = __assign({}, SCOPE_PSEUDO);\n\nvar UNIVERSAL_SELECTOR = {\n  type: \"universal\",\n  namespace: null\n};\n\nfunction filterByPosition(filter, elems, data, options) {\n  var num = typeof data === \"string\" ? parseInt(data, 10) : NaN;\n\n  switch (filter) {\n    case \"first\":\n    case \"lt\":\n      // Already done in `getLimit`\n      return elems;\n\n    case \"last\":\n      return elems.length > 0 ? [elems[elems.length - 1]] : elems;\n\n    case \"nth\":\n    case \"eq\":\n      return isFinite(num) && Math.abs(num) < elems.length ? [num < 0 ? elems[elems.length + num] : elems[num]] : [];\n\n    case \"gt\":\n      return isFinite(num) ? elems.slice(num + 1) : [];\n\n    case \"even\":\n      return elems.filter(function (_, i) {\n        return i % 2 === 0;\n      });\n\n    case \"odd\":\n      return elems.filter(function (_, i) {\n        return i % 2 === 1;\n      });\n\n    case \"not\":\n      {\n        var filtered_1 = new Set(filterParsed(data, elems, options));\n        return elems.filter(function (e) {\n          return !filtered_1.has(e);\n        });\n      }\n  }\n}\n\nfunction filter(selector, elements, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  return DomUtils.uniqueSort(filterParsed(css_what_1.parse(selector, options), elements, options));\n}\n\nexports.filter = filter;\n/**\n * Filter a set of elements by a selector.\n *\n * If there are multiple selectors, this can\n * return elements multiple times; use `uniqueSort`\n * to eliminate duplicates afterwards.\n *\n * @param selector Selector to filter by.\n * @param elements Elements to filter.\n * @param options Options for selector.\n */\n\nfunction filterParsed(selector, elements, options) {\n  if (elements.length === 0) return [];\n\n  var _a = helpers_1.groupSelectors(selector),\n      plainSelectors = _a[0],\n      filteredSelectors = _a[1];\n\n  var results = [];\n\n  if (plainSelectors.length) {\n    results.push(filterElements(elements, plainSelectors, options));\n  }\n\n  for (var _i = 0, filteredSelectors_1 = filteredSelectors; _i < filteredSelectors_1.length; _i++) {\n    var filteredSelector = filteredSelectors_1[_i];\n\n    if (filteredSelector.some(css_what_1.isTraversal)) {\n      /*\n       * Get one root node, run selector with the scope\n       * set to all of our nodes.\n       */\n      var root = helpers_1.getDocumentRoot(elements[0]);\n\n      var sel = __spreadArrays(filteredSelector, [CUSTOM_SCOPE_PSEUDO]);\n\n      results.push(findFilterElements(root, sel, options, true, elements));\n    } else {\n      // Performance optimization: If we don't have to traverse, just filter set.\n      results.push(findFilterElements(elements, filteredSelector, options, false));\n    }\n  }\n\n  if (results.length === 1) {\n    return results[0];\n  }\n\n  return results.reduce(function (arr, rest) {\n    return __spreadArrays(arr, rest);\n  }, []);\n}\n\nfunction select(selector, root, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _a = helpers_1.groupSelectors(css_what_1.parse(selector, options)),\n      plain = _a[0],\n      filtered = _a[1];\n\n  var results = filtered.map(function (sel) {\n    return findFilterElements(root, sel, options, true);\n  }); // Plain selectors can be queried in a single go\n\n  if (plain.length) {\n    results.push(findElements(root, plain, options, Infinity));\n  } // If there was only a single selector, just return the result\n\n\n  if (results.length === 1) {\n    return results[0];\n  } // Sort results, filtering for duplicates\n\n\n  return DomUtils.uniqueSort(results.reduce(function (a, b) {\n    return __spreadArrays(a, b);\n  }));\n}\n\nexports.select = select; // Traversals that are treated differently in css-select.\n\nvar specialTraversal = new Set([\"descendant\", \"adjacent\"]);\n\nfunction includesScopePseudo(t) {\n  return t !== SCOPE_PSEUDO && t.type === \"pseudo\" && (t.name === \"scope\" || Array.isArray(t.data) && t.data.some(function (data) {\n    return data.some(includesScopePseudo);\n  }));\n}\n\nfunction addContextIfScope(selector, options, scopeContext) {\n  return scopeContext && selector.some(includesScopePseudo) ? __assign(__assign({}, options), {\n    context: scopeContext\n  }) : options;\n}\n/**\n *\n * @param root Element(s) to search from.\n * @param selector Selector to look for.\n * @param options Options for querying.\n * @param queryForSelector Query multiple levels deep for the initial selector, even if it doesn't contain a traversal.\n * @param scopeContext Optional context for a :scope.\n */\n\n\nfunction findFilterElements(root, selector, options, queryForSelector, scopeContext) {\n  var filterIndex = selector.findIndex(positionals_1.isFilter);\n  var sub = selector.slice(0, filterIndex);\n  var filter = selector[filterIndex];\n  /*\n   * Set the number of elements to retrieve.\n   * Eg. for :first, we only have to get a single element.\n   */\n\n  var limit = positionals_1.getLimit(filter.name, filter.data);\n  if (limit === 0) return [];\n  var subOpts = addContextIfScope(sub, options, scopeContext);\n  /*\n   * Skip `findElements` call if our selector starts with a positional\n   * pseudo.\n   */\n\n  var elemsNoLimit = sub.length === 0 && !Array.isArray(root) ? DomUtils.getChildren(root).filter(DomUtils.isTag) : sub.length === 0 || sub.length === 1 && sub[0] === SCOPE_PSEUDO ? Array.isArray(root) ? root : [root] : queryForSelector || sub.some(css_what_1.isTraversal) ? findElements(root, [sub], subOpts, limit) : // We know that this cannot be reached with root not being an array.\n  filterElements(root, [sub], subOpts);\n  var elems = elemsNoLimit.slice(0, limit);\n  var result = filterByPosition(filter.name, elems, filter.data, options);\n\n  if (result.length === 0 || selector.length === filterIndex + 1) {\n    return result;\n  }\n\n  var remainingSelector = selector.slice(filterIndex + 1);\n  var remainingHasTraversal = remainingSelector.some(css_what_1.isTraversal);\n  var remainingOpts = addContextIfScope(remainingSelector, options, scopeContext);\n\n  if (remainingHasTraversal) {\n    /*\n     * Some types of traversals have special logic when they start a selector\n     * in css-select. If this is the case, add a universal selector in front of\n     * the selector to avoid this behavior.\n     */\n    if (specialTraversal.has(remainingSelector[0].type)) {\n      remainingSelector.unshift(UNIVERSAL_SELECTOR);\n    }\n    /*\n     * Add a scope token in front of the remaining selector,\n     * to make sure traversals don't match elements that aren't a\n     * part of the considered tree.\n     */\n\n\n    remainingSelector.unshift(SCOPE_PSEUDO);\n  }\n  /*\n   * If we have another filter, recursively call `findFilterElements`,\n   * with the `recursive` flag disabled. We only have to look for more\n   * elements when we see a traversal.\n   *\n   * Otherwise,\n   */\n\n\n  return remainingSelector.some(positionals_1.isFilter) ? findFilterElements(result, remainingSelector, options, false, scopeContext) : remainingHasTraversal ? // Query existing elements to resolve traversal.\n  findElements(result, [remainingSelector], remainingOpts, Infinity) : // If we don't have any more traversals, simply filter elements.\n  filterElements(result, [remainingSelector], remainingOpts);\n}\n\nfunction findElements(root, sel, options, limit) {\n  if (limit === 0) return []; // @ts-expect-error TS seems to mess up the type here ¯\\_(ツ)_/¯\n\n  var query = css_select_1._compileToken(sel, options, root);\n\n  var elems = css_select_1.prepareContext(root, DomUtils, query.shouldTestNextSiblings);\n  return DomUtils.find(function (node) {\n    return DomUtils.isTag(node) && query(node);\n  }, elems, true, limit);\n}\n\nfunction filterElements(elements, sel, options) {\n  // @ts-expect-error TS seems to mess up the type here ¯\\_(ツ)_/¯\n  var query = css_select_1._compileToken(sel, options);\n\n  return elements.filter(query);\n}","map":{"version":3,"sources":["/home/conrad/Documents/tarot/tarot-cards/node_modules/cheerio-select-tmp/lib/index.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__createBinding","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","__spreadArrays","il","r","Array","a","j","jl","exports","select","filter","css_what_1","require","css_select_1","DomUtils","helpers_1","positionals_1","SCOPE_PSEUDO","type","name","data","CUSTOM_SCOPE_PSEUDO","UNIVERSAL_SELECTOR","namespace","filterByPosition","elems","options","num","parseInt","NaN","isFinite","Math","abs","slice","_","filtered_1","Set","filterParsed","e","has","selector","elements","uniqueSort","parse","_a","groupSelectors","plainSelectors","filteredSelectors","results","push","filterElements","_i","filteredSelectors_1","filteredSelector","some","isTraversal","root","getDocumentRoot","sel","findFilterElements","reduce","arr","rest","plain","filtered","map","findElements","Infinity","b","specialTraversal","includesScopePseudo","isArray","addContextIfScope","scopeContext","context","queryForSelector","filterIndex","findIndex","isFilter","sub","limit","getLimit","subOpts","elemsNoLimit","getChildren","isTag","remainingSelector","remainingHasTraversal","remainingOpts","unshift","query","_compileToken","prepareContext","shouldTestNextSiblings","find","node"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.select = exports.filter = void 0;\nvar css_what_1 = require(\"css-what\");\nvar css_select_1 = require(\"css-select\");\nvar DomUtils = __importStar(require(\"domutils\"));\nvar helpers_1 = require(\"./helpers\");\nvar positionals_1 = require(\"./positionals\");\n/** Used to indicate a scope should be filtered. Might be ignored when filtering. */\nvar SCOPE_PSEUDO = {\n    type: \"pseudo\",\n    name: \"scope\",\n    data: null,\n};\n/** Used for actually filtering for scope. */\nvar CUSTOM_SCOPE_PSEUDO = __assign({}, SCOPE_PSEUDO);\nvar UNIVERSAL_SELECTOR = { type: \"universal\", namespace: null };\nfunction filterByPosition(filter, elems, data, options) {\n    var num = typeof data === \"string\" ? parseInt(data, 10) : NaN;\n    switch (filter) {\n        case \"first\":\n        case \"lt\":\n            // Already done in `getLimit`\n            return elems;\n        case \"last\":\n            return elems.length > 0 ? [elems[elems.length - 1]] : elems;\n        case \"nth\":\n        case \"eq\":\n            return isFinite(num) && Math.abs(num) < elems.length\n                ? [num < 0 ? elems[elems.length + num] : elems[num]]\n                : [];\n        case \"gt\":\n            return isFinite(num) ? elems.slice(num + 1) : [];\n        case \"even\":\n            return elems.filter(function (_, i) { return i % 2 === 0; });\n        case \"odd\":\n            return elems.filter(function (_, i) { return i % 2 === 1; });\n        case \"not\": {\n            var filtered_1 = new Set(filterParsed(data, elems, options));\n            return elems.filter(function (e) { return !filtered_1.has(e); });\n        }\n    }\n}\nfunction filter(selector, elements, options) {\n    if (options === void 0) { options = {}; }\n    return DomUtils.uniqueSort(filterParsed(css_what_1.parse(selector, options), elements, options));\n}\nexports.filter = filter;\n/**\n * Filter a set of elements by a selector.\n *\n * If there are multiple selectors, this can\n * return elements multiple times; use `uniqueSort`\n * to eliminate duplicates afterwards.\n *\n * @param selector Selector to filter by.\n * @param elements Elements to filter.\n * @param options Options for selector.\n */\nfunction filterParsed(selector, elements, options) {\n    if (elements.length === 0)\n        return [];\n    var _a = helpers_1.groupSelectors(selector), plainSelectors = _a[0], filteredSelectors = _a[1];\n    var results = [];\n    if (plainSelectors.length) {\n        results.push(filterElements(elements, plainSelectors, options));\n    }\n    for (var _i = 0, filteredSelectors_1 = filteredSelectors; _i < filteredSelectors_1.length; _i++) {\n        var filteredSelector = filteredSelectors_1[_i];\n        if (filteredSelector.some(css_what_1.isTraversal)) {\n            /*\n             * Get one root node, run selector with the scope\n             * set to all of our nodes.\n             */\n            var root = helpers_1.getDocumentRoot(elements[0]);\n            var sel = __spreadArrays(filteredSelector, [CUSTOM_SCOPE_PSEUDO]);\n            results.push(findFilterElements(root, sel, options, true, elements));\n        }\n        else {\n            // Performance optimization: If we don't have to traverse, just filter set.\n            results.push(findFilterElements(elements, filteredSelector, options, false));\n        }\n    }\n    if (results.length === 1) {\n        return results[0];\n    }\n    return results.reduce(function (arr, rest) { return __spreadArrays(arr, rest); }, []);\n}\nfunction select(selector, root, options) {\n    if (options === void 0) { options = {}; }\n    var _a = helpers_1.groupSelectors(css_what_1.parse(selector, options)), plain = _a[0], filtered = _a[1];\n    var results = filtered.map(function (sel) {\n        return findFilterElements(root, sel, options, true);\n    });\n    // Plain selectors can be queried in a single go\n    if (plain.length) {\n        results.push(findElements(root, plain, options, Infinity));\n    }\n    // If there was only a single selector, just return the result\n    if (results.length === 1) {\n        return results[0];\n    }\n    // Sort results, filtering for duplicates\n    return DomUtils.uniqueSort(results.reduce(function (a, b) { return __spreadArrays(a, b); }));\n}\nexports.select = select;\n// Traversals that are treated differently in css-select.\nvar specialTraversal = new Set([\"descendant\", \"adjacent\"]);\nfunction includesScopePseudo(t) {\n    return (t !== SCOPE_PSEUDO &&\n        t.type === \"pseudo\" &&\n        (t.name === \"scope\" ||\n            (Array.isArray(t.data) &&\n                t.data.some(function (data) { return data.some(includesScopePseudo); }))));\n}\nfunction addContextIfScope(selector, options, scopeContext) {\n    return scopeContext && selector.some(includesScopePseudo)\n        ? __assign(__assign({}, options), { context: scopeContext }) : options;\n}\n/**\n *\n * @param root Element(s) to search from.\n * @param selector Selector to look for.\n * @param options Options for querying.\n * @param queryForSelector Query multiple levels deep for the initial selector, even if it doesn't contain a traversal.\n * @param scopeContext Optional context for a :scope.\n */\nfunction findFilterElements(root, selector, options, queryForSelector, scopeContext) {\n    var filterIndex = selector.findIndex(positionals_1.isFilter);\n    var sub = selector.slice(0, filterIndex);\n    var filter = selector[filterIndex];\n    /*\n     * Set the number of elements to retrieve.\n     * Eg. for :first, we only have to get a single element.\n     */\n    var limit = positionals_1.getLimit(filter.name, filter.data);\n    if (limit === 0)\n        return [];\n    var subOpts = addContextIfScope(sub, options, scopeContext);\n    /*\n     * Skip `findElements` call if our selector starts with a positional\n     * pseudo.\n     */\n    var elemsNoLimit = sub.length === 0 && !Array.isArray(root)\n        ? DomUtils.getChildren(root).filter(DomUtils.isTag)\n        : sub.length === 0 || (sub.length === 1 && sub[0] === SCOPE_PSEUDO)\n            ? Array.isArray(root)\n                ? root\n                : [root]\n            : queryForSelector || sub.some(css_what_1.isTraversal)\n                ? findElements(root, [sub], subOpts, limit)\n                : // We know that this cannot be reached with root not being an array.\n                    filterElements(root, [sub], subOpts);\n    var elems = elemsNoLimit.slice(0, limit);\n    var result = filterByPosition(filter.name, elems, filter.data, options);\n    if (result.length === 0 || selector.length === filterIndex + 1) {\n        return result;\n    }\n    var remainingSelector = selector.slice(filterIndex + 1);\n    var remainingHasTraversal = remainingSelector.some(css_what_1.isTraversal);\n    var remainingOpts = addContextIfScope(remainingSelector, options, scopeContext);\n    if (remainingHasTraversal) {\n        /*\n         * Some types of traversals have special logic when they start a selector\n         * in css-select. If this is the case, add a universal selector in front of\n         * the selector to avoid this behavior.\n         */\n        if (specialTraversal.has(remainingSelector[0].type)) {\n            remainingSelector.unshift(UNIVERSAL_SELECTOR);\n        }\n        /*\n         * Add a scope token in front of the remaining selector,\n         * to make sure traversals don't match elements that aren't a\n         * part of the considered tree.\n         */\n        remainingSelector.unshift(SCOPE_PSEUDO);\n    }\n    /*\n     * If we have another filter, recursively call `findFilterElements`,\n     * with the `recursive` flag disabled. We only have to look for more\n     * elements when we see a traversal.\n     *\n     * Otherwise,\n     */\n    return remainingSelector.some(positionals_1.isFilter)\n        ? findFilterElements(result, remainingSelector, options, false, scopeContext)\n        : remainingHasTraversal\n            ? // Query existing elements to resolve traversal.\n                findElements(result, [remainingSelector], remainingOpts, Infinity)\n            : // If we don't have any more traversals, simply filter elements.\n                filterElements(result, [remainingSelector], remainingOpts);\n}\nfunction findElements(root, sel, options, limit) {\n    if (limit === 0)\n        return [];\n    // @ts-expect-error TS seems to mess up the type here ¯\\_(ツ)_/¯\n    var query = css_select_1._compileToken(sel, options, root);\n    var elems = css_select_1.prepareContext(root, DomUtils, query.shouldTestNextSiblings);\n    return DomUtils.find(function (node) { return DomUtils.isTag(node) && query(node); }, elems, true, limit);\n}\nfunction filterElements(elements, sel, options) {\n    // @ts-expect-error TS seems to mess up the type here ¯\\_(ツ)_/¯\n    var query = css_select_1._compileToken(sel, options);\n    return elements.filter(query);\n}\n"]},"metadata":{},"sourceType":"script"}